@model WorldTour.Models.SearchViewModel

@{
    ViewBag.Title = "Search";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section id="searchBar">
    @RenderPage("~/Views/Home/SearchBarPartial.cshtml", Model)
</section>

<section id="results">
    <p style="text-align:center; font-weight:700; font-size:20px">
        Your search was for @Model.adults adults <text> and </text> @Model.children <text> children, on @Model.classType class.</text>
    </p>
    @using (Html.BeginForm("Search", "Home"))
            {
        <div id="table-wrapper">
            <div id="table-scroll">

                <table class="table table-hover table-responsive">
                    <thead>
                    <tr>
                        <th><span class="text">Departure</span></th>
                        <th><span class="text">Destination</span></th>
                        <th><span class="text">Departure Time</span></th>
                        <th><span class="text">Arrival Time</span></th>
                        <th><span class="text">Company</span></th>
                        <th><span class="text">Available Seats</span></th>
                        <th><span class="text">Total Cost</span></th>
                        <th><span class="text">Your Choice</span></th>
                    </tr>
                 </thead>
                 <tbody>
                    @{
                        if (Model.resultsGo.Count() >= 0)
                        {
                            <tr>
                                <th colspan="8" style="text-align:center; font-size:20px; text-decoration:underline;">Departure Flights</th>
                            </tr>

                            int a = 0;
                            foreach (var res in Model.resultsGo)
                            {
                                a++;
                                decimal price;
                                switch (Model.classType)
                                {
                                    case "First":
                                        price = res.Starting_Price * 2;
                                        break;
                                    case "Business":
                                        price = res.Starting_Price * (decimal)1.5;
                                        break;
                                    default:
                                        price = res.Starting_Price;
                                        break;
                                }
                                <tr class="flightTD">
                                    <td>@res.Departure_Airport</td>
                                    <td>@res.Arrival_Airport</td>
                                    <td>@res.Departure_Date.ToString("dd/MM/yyyy h:mm tt")</td>
                                    <td>@res.Arrival_Date.ToString("dd/MM/yyyy h:mm tt")</td>
                                    <td>@res.Company_Name</td>
                                    <td>@res.Available_Seats</td>
                                    <td>@Math.Round(price * (decimal)Model.adults + price * (decimal)Model.children * (decimal)0.5, 2)<text>&nbsp;&euro;</text></td>
                                    <td><input type="radio" name="goFlight" value="@res.FlightID" required onclick="revealBook('bookButton')" /></td>
                                </tr>
                            }
                            if (a == 0)
                            {
                                <tr><td colspan="8" style="text-align:center; font-weight:700">There is no available departure flight</td></tr>
                            }
                        }

                        if (Model.resultsReturn.Count() > 0)
                        {
                            <tr>
                                <th colspan="8" style="text-align:center; font-size:20px; text-decoration:underline;">Return Flights</th>
                            </tr>

                            int b = 0;
                            foreach (var res in Model.resultsReturn)
                            {
                                b++;
                                decimal price;
                                switch (Model.classType)
                                {
                                    case "First":
                                        price = res.Starting_Price * 2;
                                        break;
                                    case "Business":
                                        price = res.Starting_Price * (decimal)1.5;
                                        break;
                                    default:
                                        price = res.Starting_Price;
                                        break;
                                }
                                <tr class="flightTD">
                                    <td>@res.Departure_Airport</td>
                                    <td>@res.Arrival_Airport</td>
                                    <td>@res.Departure_Date.ToString("dd/MM/yyyy h:mm tt")</td>
                                    <td>@res.Arrival_Date.ToString("dd/MM/yyyy h:mm tt")</td>
                                    <td>@res.Company_Name</td>
                                    <td>@res.Available_Seats</td>
                                    <td>@Math.Round(price * (decimal)Model.adults + price * (decimal)Model.children * (decimal)0.5, 2)<text>&nbsp;&euro;</text></td>
                                    <td><input type="radio" name="returnFlight" value="@res.FlightID" required onclick="revealBook('bookButton')" /></td>
                                </tr>
                            }
                            if (b == 0)
                            {
                                <tr><td colspan="8" style="text-align:center; font-weight:700">There is no available return flight</td></tr>
                            }
                        }
                    }
                     </tbody>
                </table>
                </div>
            </div>
                <input type="hidden" name="classType" value="@Model.classType" />
                <input type="hidden" name="children" value="@Model.children" />
                <input type="hidden" name="adults" value="@Model.adults" />
                <input type="submit" value="Book Now!" class="btn btn-success btn-lg" style="margin-top:20px;margin-bottom:15px;display:none" name="bookButton" id="bookButton" />
                }
    </section>

<script type="text/javascript">
    function revealBook(id) {
        var g = document.getElementById('bookButton');
        g.style.display = ((g.style.display == 'none') ? 'block' : 'block');
    }
</script>


